{
  "name": "logfmt",
  "version": "0.18.1",
  "description": "key=value logger and parser",
  "main": "logfmt.js",
  "scripts": {
    "test": "mocha"
  },
  "bin": {
    "logfmt": "./bin/logfmt"
  },
  "dependencies": {
    "split": "0.2.x",
    "through": "2.3.x",
    "readable-stream": "1.0.x"
  },
  "devDependencies": {
    "express": "3.3.x",
    "mocha": "*",
    "restify": "*"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/csquared/node-logfmt"
  },
  "keywords": [
    "Log",
    "Parser",
    "logfmt"
  ],
  "author": {
    "name": "csquared"
  },
  "license": "BSD",
  "readme": "# node-logfmt\n\n[![Build Status](https://travis-ci.org/csquared/node-logfmt.png)](https://travis-ci.org/csquared/node-logfmt)\n\n\n\"logfmt\" is the name for a [key value logging convention](https://github.com/kr/logfmt) we've adopted at Heroku.\n\nThis library is for both converting lines in logfmt format to objects and\nfor logging objects to a stream in logfmt format.\nIt provides a logfmt parser, a logging facility,\nand both streaming and non-streaming body parsers for express.\n\nYou should use this library if you're trying to write structured logs or\nif you're consuming them (especially if you're writing a logplex drain).\n\n## install\n\n    npm install logfmt\n\n# use\n\n```javascript\nvar logfmt = require('logfmt');\n```\n\n## parser\n\n### `logfmt.parse(string)`\n\n```javascript\nvar logfmt = require('logfmt');\n\nlogfmt.parse(\"foo=bar a=14 baz=\\\"hello kitty\\\" cool%story=bro f %^asdf code=H12\")\n//=>{ \"foo\": \"bar\", \"a\": '14', \"baz\": \"hello kitty\", \"cool%story\": \"bro\", \"f\": true, \"%^asdf\": true, \"code\" : \"H12\" }\n```\n\nThe only conversions are from the strings `true` and `false` to their proper boolean counterparts.\nWe cannot arbitrarily convert numbers because we will drop precision for numbers that require more than 32 bits to represent them.\n\n## logging\n\n### `logfmt.log(object, [stream])`\n\nDefaults to logging to `process.stdout`\n\n```javascript\nvar logfmt = require('logfmt');\nlogfmt.log({ \"foo\": \"bar\", \"a\": 14, baz: 'hello kitty'})\n//=> foo=bar a=14 baz=\"hello kitty\"\n```\n\nYou can have multiple, isolated logfmts by using `new`.\n\n```javascript\nvar logfmt = require('logfmt');\nvar errorLogger = new logfmt;\nerrorLogger.stream = process.stderr\n\nlogfmt.log({hello: 'stdout'});\n//=> hello=stdout\n\nerrorLogger.log({hello: 'stderr'});\n//=> hello=stderr\n```\n\n### `logfmt.namespace(object)`\n\nReturns a new `logfmt` with object's data included in every `log` call.\n\n```javascript\nvar logfmt = require('logfmt').namespace({app: 'logfmt'});\n\nlogfmt.log({ \"foo\": \"bar\", \"a\": 14, baz: 'hello kitty'})\n//=> app=logfmt foo=bar a=14 baz=\"hello kitty\"\n\nlogfmt.log({})\n//=> app=logfmt\n\nlogfmt.log({hello: 'world'})\n//=> app=logfmt hello=world\n```\n\n### `logfmt.time([label], [data], [callback(logger)])`\n\n#### `logger.log([data], [stream])`\n\nLog how long something takes.\n\n- `label`: optional name for the milliseconds key (defaults to `elapsed`)\n- `data`: optional extra data to include with every call to `logger.log`\n- `logger`: object passed to callback with a `log` function\n\nNo args defaults to `elapsed=<milliseconds>ms`\n\n```javascript\nlogfmt.time(function(logger){\n  logger.log();\n})\n//=> elapsed=1ms\n```\n\nIf you don't pass in callback you get the logger returned.\n```javascript\nvar logger = logfmt.time();\nlogger.log();\n//=> elapsed=1ms\n```\n\nString `label` changes the key to `<string>=<milliseconds>ms`\n\n```javascript\nlogfmt.time('time', function(logger){\n  logger.log();\n  logger.log();\n})\n//=> time=1ms\n//=> time=2ms\n```\n\nData can be passed to `logger.log`\n\n```javascript\nlogfmt.time(function(logger){\n  logger.log({foo: 'bar'});\n})\n//=> foo=bar elapsed=1ms\n```\n\nData can also be passed to `logfmt.time` and will persist\nacross calls to `logger.log`\n\n```javascript\nlogfmt.time('thing', {foo: 'bar'}, function(logger){\n  logger.log({at: 'function.start'});\n  logger.log({at: 'function.end'});\n})\n//=> at=function.start foo=bar thing=1ms\n//=> at=function.end foo=bar thing=2ms\n```\n\nYou do not need a `label` to pass data to `logfmt.time`\n\n```javascript\nlogfmt.time({foo: 'bar'}, function(logger){\n  logger.log({at: 'function'});\n})\n//=> at=function foo=bar elapsed=1ms\n```\n\n`time` works with `namespace` as expected\n\n```javascript\nvar logfmt = require('logfmt').namespace({app: 'logfmt'})\n\nlogfmt.time({foo: 'bar'}, function(logger){\n  logger.log({at: 'function'});\n})\n//=> app=logfmt at=function foo=bar elapsed=1ms\n```\n\n### customizing logging location\n\n`logfmt.log()` and `logger.log()` Accepts as 2nd argument anything that responds to `write(string)`\n```javascript\nvar logfmt = require('logfmt');\nlogfmt.log({ \"foo\": \"bar\", \"a\": 14, baz: 'hello kitty'}, process.stderr)\n//=> foo=bar a=14 baz=\"hello kitty\"\n```\n\nOverwrite the default global location by setting `logfmt.stream`\n```javascript\nvar logfmt = require('logfmt');\nlogfmt.stream = process.stderr\n\nlogfmt.log({ \"foo\": \"bar\", \"a\": 14, baz: 'hello kitty'})\n//=> foo=bar a=14 baz=\"hello kitty\"\n```\n\n### logging errors\n\n`logfmt.error()` Accepts a Javascript `Error` object and converts it to logfmt format\n```javascript\nvar logfmt = require('logfmmt');\nlogfmt.error(new Error('test error'));\n//=> at=error id=12345 message=\"test error\"\n//=> at=error id=12345 line=0 trace=\"Error: test error\"\n//=> ...\n```\n\n## express/restify logging middleware\n\n```javascript\napp.use(logfmt.requestLogger());\n//=> ip=127.0.0.1 time=2013-08-05T20:50:19.216Z method=POST path=/logs status=200 content_length=337 content_type=application/logplex-1 elapsed=4ms\n```\n\n#### `logfmt.requestLogger([options], [formatter(req, res)])`\n\nIf no formatter is supplied it will default to `logfmt.requestLogger.commonFormatter` which is based\non having similiar fields to the Apache Common Log format.\n\nValid Options:\n\n- `immediate`: log before call to `next()` (ie: before the request finishes)\n- `elapsed`: renames the `elapsed` key to a key of your choice when in\n             non-immediate mode\n\nDefaults to `immediate: true` and `elapsed: 'elapsed'`\n\n```javascript\napp.use(logfmt.requestLogger({immediate: true}, function(req, res){\n  return {\n    method: req.method\n  }\n}));\n//=> method=POST\n```\n\n```javascript\napp.use(logfmt.requestLogger({elapsed: 'request.time'}, function(req, res){\n  return {\n    \"request.method\": req.method\n  }\n}));\n//=> request.method=POST request.time=12ms\n```\n\n##### `formatter(req, res)`\n\nA formatter takes the request and response and returns a JSON object for `logfmt.log`\n\n```javascript\napp.use(logfmt.requestLogger(function(req, res){\n  return {\n    method: req.method\n  }\n}));\n//=> method=POST elapsed=4ms\n```\n\nIt's always possible to piggyback on top of the `commonFormatter`\n\n```javascript\napp.use(logfmt.requestLogger(function(req, res){\n  var data = logfmt.requestLogger.commonFormatter(req, res)\n  return {\n    ip: data.ip,\n    time: data.time,\n    foo: 'bar'\n  };\n}));\n//=> ip=127.0.0.1 time=2013-08-05T20:50:19.216Z foo=bar elapsed=4ms\n```\n\n## express/restify parsing middleware\n\n```javascript\n  // streaming\n  app.use(logfmt.bodyParserStream());\n  // buffering\n  app.use(logfmt.bodyParser());\n```\n\n### Streaming\n\n#### `logfmt.bodyParserStream([opts])`\n\nValid Options:\n\n- `contentType`: defaults to `application/logplex-1`\n\nIf you use the `logfmt.bodyParserStream()` for a body parser,\nyou will have a `req.body` that is a readable stream.\n\nPipes FTW:\n\n```javascript\nvar app    = require('express')();\nvar http   = require('http');\nvar through = require('through');\nvar logfmt  = require('logfmt');\n\napp.use(logfmt.bodyParserStream());\n\napp.post('/logs', function(req, res){\n  if(!req.body) return res.send('OK');\n\n  req.body.pipe(through(function(line){\n    console.dir(line);\n  }))\n\n  res.send('OK');\n})\n\nhttp.createServer(app).listen(3000);\n```\n\nOr you can just use the `readable` event:\n\n```javascript\nvar app    = require('express')();\nvar http   = require('http');\nvar logfmt  = require('logfmt');\n\napp.use(logfmt.bodyParserStream());\n\n// req.body is now a Readable Stream\napp.post('/logs', function(req, res){\n  req.body.on('readable', function(){\n    var parsedLine = req.body.read();\n    if(parsedLine) console.log(parsedLine);\n    else res.send('OK');\n  })\n})\n\nhttp.createServer(app).listen(3000);\n```\n\n### Non-Streaming\n\n#### `logfmt.bodyParser([opts])`\n\nValid Options:\n\n- `contentType`: defaults to `application/logplex-1`\n\nIf you use the `logfmt.bodyParser()` for a body parser,\nyou will have a `req.body` that is an array of objects.\n\n```javascript\nvar logfmt   = require('logfmt');\n\napp.use(logfmt.bodyParser());\n\n// req.body is now an array of objects\napp.post('/logs', function(req, res){\n\n  console.log('BODY: ' + JSON.stringify(req.body));\n\n  req.body.forEach(function(data){\n    console.log(data);\n  });\n\n  res.send('OK');\n})\n\nhttp.createServer(app).listen(3000);\n```\n\ntest it:\n\n```bash\ncurl -X POST --header 'Content-Type: application/logplex-1' -d \"foo=bar a=14 baz=\\\"hello kitty\\\" cool%story=bro f %^asdf\" http://localhost:3000/logs\n```\n\n## command line\n\n### logfmt\n\naccepts lines on STDIN and converts them to json\n\n\n    > echo \"foo=bar a=14 baz=\\\"hello kitty\\\" cool%story=bro f %^asdf\" | logfmt\n    { \"foo\": \"bar\", \"a\": 14, \"baz\": \"hello kitty\", \"cool%story\": \"bro\", \"f\": true, \"%^asdf\": true }\n\n### logfmt -r (reverse)\n\naccepts JSON on STDIN and converts them to logfmt\n\n    > echo '{ \"foo\": \"bar\", \"a\": 14, \"baz\": \"hello kitty\", \"cool%story\": \"bro\", \"f\": true, \"%^asdf\": true }' | logfmt -r\n    foo=bar a=14 baz=\"hello kitty\" cool%story=bro f=true %^asdf=true\n\n    > echo \"foo=bar a=14 baz=\\\"hello kitty\\\" cool%story=bro f %^asdf\" | logfmt | logfmt -r | logfmt\n    { \"foo\": \"bar\", \"a\": 14, \"baz\": \"hello kitty\", \"cool%story\": \"bro\", \"f\": true, \"%^asdf\": true }\n",
  "readmeFilename": "README.md",
  "bugs": {
    "url": "https://github.com/csquared/node-logfmt/issues"
  },
  "_id": "logfmt@0.18.1",
  "_from": "logfmt@"
}
